<html>
    <head>
        <meta charset="UTF-8">
        <style>
            th {
                text-align: left;
            }
            
            select.versioned {
                border: none;
                width: 100%;
            }
        </style>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
        <script>
            var fileContents = {};
        
            $(() => {
                $('#uploadFiles').change(onFilesSelected);
                $('#version').change(onVersionChanged);
                $('#reparse').click(onFileContentsLoaded);
            });
            
            function onFilesSelected(e) {
                var uploadFiles = $('#uploadFiles')[0];
                fileContents = {};
                $('#version').empty();
                var waitCounter = 0;
                for (var f = 0; f < uploadFiles.files.length; ++f) {
                    var file = uploadFiles.files[f];
                    console.log('Selected file ' + file.name);
                    if (file) {
                        ++waitCounter;
                        var reader = new FileReader();
                        reader.key = file.name;
                        reader.readAsText(file, "UTF-8");
                        reader.onload = function (evt) {
                            var content = evt.target.result;
                            const parser = new DOMParser();
                            const doc = parser.parseFromString(content, "application/xml");
                            fileContents[evt.target.key] = doc;
                            if (--waitCounter == 0) {
                                onFileContentsLoaded();
                            }
                        }
                    }
                }
            }

            function onFileContentsLoaded() {
                var records = [];
                
                function rec(key, time, value, doNotCompareWithPrevious, doNotHighlight) {
                    if (value == null) return;
                    var timeValue = {
                        time: time,
                        value: value,
                        doNotAddFrom: !!doNotCompareWithPrevious,
                        doNotHighlight: !!doNotHighlight
                    };
                    var rec = records.find(r => r.key == key);
                    if (!rec) {
                        rec = {
                            key: key,
                            values: [timeValue]
                        };
                        records.push(rec);
                    }
                    else if (doNotCompareWithPrevious || rec.values[rec.values.length - 1].value != value) {
                        rec.values.push(timeValue);
                    }
                }
                
                function sel(doc, selector, attr) {
                    try {
                        var prefix = doc.parentElement == null ? 'Dokument TrescDokumentu Wartosc ' : '';
                        var el = doc.querySelector(prefix + selector);
                        if (attr) {
                            return el.attributes[attr].value;
                        }
                        return el.innerHTML;
                    }
                    catch (error) {
                        return null;
                    }
                }

                function attr(el, name) {
                    if (name in el.attributes) {
                        return el.attributes[name].value;
                    }
                    return null;
                }

                function modified(doc, selector) {
                    if (sel(doc, 'RodzajWniosku') == '1') return true;
                    var el = doc.querySelector('Dokument TrescDokumentu Wartosc ' + selector);
                    if (el == null) return false;
                    var mod = el.attributes.modyfikacja;
                    return !mod || mod.value == '1';
                }
                
                function recm(key, time, doc, selector, additionalSelector) {
                    if (modified(doc, selector)) {
                        rec(key, time, sel(doc, selector + (additionalSelector ? ' ' + additionalSelector : '')));
                    }
                }
                
                function foreignerStatus(value) {
                    if (value == 2) return '–Ø–≤–ª—è—é—Å—å –∏–Ω–æ—Å—Ç—Ä–∞–Ω—Ü–µ–º –Ω–µ –∏–∑ –ï–°, –∏–º–µ—é—â–∏–º –ø—Ä–∞–≤–æ –≤–µ—Å—Ç–∏ —Ö–æ–∑–¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –ü–æ–ª—å—à–µ';
                    if (value === null) return '–°—Ç–∞—Ç—É—Å –Ω–µ —É–∫–∞–∑–∞–Ω –≤ —Ñ–∞–π–ª–µ';
                    return '–°–æ–æ–±—â–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É, —á—Ç–æ –≤ —Ç–≤–æ—ë–º —Ñ–∞–π–ª–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞: ' + value;
                }
                
                function communityOfProperty(value) {
                    if (value == 1) return '–∏–º–µ–µ—Ç—Å—è';
                    if (value == 2) return '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';
                    return '–ù–µ –∫–∞—Å–∞–µ—Ç—Å—è';
                }
                
                var pkd = {};
                var businessBankAccounts = {};
                var privateBankAccounts = {};

                var names = Object.getOwnPropertyNames(fileContents).sort();

                var times = {};
                var prevName;
                var prevTime;
                var inDayCounter = 1;
                for (var n in names) {
                    var doc = fileContents[names[n]];
                    var isUpdate = sel(doc, 'RodzajWniosku') == '2';
                    var submissionDate = sel(doc, 'DataZlozeniaWniosku Czas');
                    var time = isUpdate ? sel(doc, 'DataPowstaniaZmiany Czas') : submissionDate;
                    var timeSuffix = '';
                    if (time == prevTime) {
                        if (inDayCounter == 1) times[prevName] += 'A';
                        timeSuffix = String.fromCharCode(64 + ++inDayCounter);
                    }
                    else inDayCounter = 1;
                    prevTime = time;
                    prevName = names[n];
                    times[names[n]] = time + timeSuffix;
                }

                var ni = 0;
                for (var n in names) {
                    ++ni;
                    var doc = fileContents[names[n]];
                    var time = times[names[n]];
                    $('#version').append($('<option value="' + time + '">' + ni + '. ' + time + '</option>'));
                    $('#version').val(time);

                    var context = 'Wnioskodawca DaneWnioskodawcy';
                    if (modified(doc, context)) {
                        var prefix = '2. –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ - ';
                        rec(prefix + '–ü–æ–ª', time, sel(doc, context + ' Plec'));
                        rec(prefix + '–ò–º—è', time, sel(doc, context + ' Imie'));
                        rec(prefix + '–í—Ç–æ—Ä–æ–µ –∏–º—è', time, sel(doc, context + ' ImieDrugie'));
                        rec(prefix + '–§–∞–º–∏–ª–∏—è', time, sel(doc, context + ' Nazwisko'));
                        rec(prefix + '–§–∞–º–∏–ª–∏—è –æ—Ç —Ä–æ–∂–¥–µ–Ω–∏—è', time, sel(doc, context + ' NazwiskoRodowe'));
                        rec(prefix + '–ò–º—è –º–∞—Ç–µ—Ä–∏', time, sel(doc, context + ' ImieMatki'));
                        rec(prefix + '–ò–º—è –æ—Ç—Ü–∞', time, sel(doc, context + ' ImieOjca'));
                        rec(prefix + '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è', time, sel(doc, context + ' DataUrodzenia Czas'));
                        rec(prefix + '–ú–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è', time, sel(doc, context + ' MiejsceUrodzenia'));
                        rec(prefix + '–ì—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ', time, sel(doc, context + ' PosiadaneObywatelstwa Obywatelstwo'));
                        rec(prefix + '–ò–Ω–æ—Å—Ç—Ä–∞–Ω–µ—Ü - –°—Ç–∞—Ç—É—Å', time, foreignerStatus(sel(doc, context + ' Cudzoziemiec Status')));
                        rec(prefix + '–ò–Ω–æ—Å—Ç—Ä–∞–Ω–µ—Ü - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç - –°–∏–≥–Ω–∞—Ç—É—Ä–∞', time, sel(doc, context + ' Cudzoziemiec Identyfikator Sygnatura'));
                        rec(prefix + '–ò–Ω–æ—Å—Ç—Ä–∞–Ω–µ—Ü - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç - –ö–µ–º –≤—ã–¥–∞–Ω', time, sel(doc, context + ' Cudzoziemiec Identyfikator OrganWydajacy'));
                        rec(prefix + '–ò–Ω–æ—Å—Ç—Ä–∞–Ω–µ—Ü - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç - –ö–æ–≥–¥–∞ –≤—ã–¥–∞–Ω', time, sel(doc, context + ' Cudzoziemiec Identyfikator DataWydania Czas'));
                        rec(prefix + '–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è - PESEL', time, sel(doc, context + ' Identyfikatory PESEL'));
                        rec(prefix + '–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è - NIP', time, sel(doc, context + ' Identyfikatory NIP') || '–Ω–µ—Ç');
                        rec(prefix + '–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è - REGON', time, sel(doc, context + ' Identyfikatory REGON') || '–Ω–µ—Ç');
                        rec(prefix + '–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è - –î–æ–∫—É–º–µ–Ω—Ç - –í–∏–¥', time, sel(doc, context + ' Identyfikatory DokumentTozsamosci Rodzaj'));
                        rec(prefix + '–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è - –î–æ–∫—É–º–µ–Ω—Ç - –ù–∞–∑–≤–∞–Ω–∏–µ', time, sel(doc, context + ' Identyfikatory DokumentTozsamosci Nazwa'));
                        rec(prefix + '–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è - –î–æ–∫—É–º–µ–Ω—Ç - –ù–æ–º–µ—Ä', time, sel(doc, context + ' Identyfikatory DokumentTozsamosci Numer'));
                    }
                    
                    context = 'Wnioskodawca AdresZamieszkania';
                    if (modified(doc, context)) {
                        prefix = '3. –ê–¥—Ä–µ—Å –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è - ';
                        rec(prefix + '–°—Ç—Ä–∞–Ω–∞', time, sel(doc, context + ' Kraj'));
                        rec(prefix + '–í–æ–µ–≤–æ–¥—Å—Ç–≤–æ', time, sel(doc, context + ' Wojewodztwo'));
                        rec(prefix + '–û–∫—Ä—É–≥', time, sel(doc, context + ' Powiat'));
                        rec(prefix + '–†–∞–π–æ–Ω', time, sel(doc, context + ' Gmina'));
                        rec(prefix + '–ü–æ—á—Ç–æ–≤—ã–π –∫–æ–¥', time, sel(doc, context + ' KodPocztowy'));
                        rec(prefix + '–ù–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç', time, sel(doc, context + ' Miejscowosc'));
                        rec(prefix + '–£–ª–∏—Ü–∞', time, sel(doc, context + ' Ulica'));
                        rec(prefix + '–ù–æ–º–µ—Ä –¥–æ–º–∞', time, sel(doc, context + ' Budynek'));
                        rec(prefix + '–ù–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã', time, sel(doc, context + ' Lokal'));
                        rec(prefix + '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è', time, sel(doc, context + ' Uwagi'));
                    }
                    
                    context = 'WpisDoEwidencji EwidencjaGospodarcza DaneDoKontaktu';
                    if (modified(doc, context)) {
                        prefix = '4. –î–∞–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω—Ç–∞–∫—Ç–∞ - ';
                        rec(prefix + '–¢–µ–ª–µ—Ñ–æ–Ω', time, sel(doc, context + ' NrTelefonu'));
                        rec(prefix + 'E-mail', time, sel(doc, context + ' Email'));
                        rec(prefix + '–°–∞–π—Ç', time, sel(doc, context + ' StronaWWW'));
                        rec(prefix + '–î—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–± –∫–æ–Ω—Ç–∞–∫—Ç–∞', time, sel(doc, context + ' InnaFormaKontaktu'));
                        rec(prefix + '–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö - –ü—É–±–ª–∏–∫–∞—Ü–∏—è', time, sel(doc, context, 'sprzeciwWobecUdostepnienia') == 1 ? '–∑–∞–ø—Ä–µ—â–µ–Ω–∞' : '—Ä–∞–∑—Ä–µ—à–µ–Ω–∞');
                    }
                    
                    context = 'WpisDoEwidencji EwidencjaGospodarcza';
                    prefix = '5. –î–∞–Ω–Ω—ã–µ —Ñ–∏—Ä–º—ã - ';
                    recm(prefix + '–ù–∞–∑–≤–∞–Ω–∏–µ', time, doc, context + ' FirmaPrzedsiebiorcy');
                    recm(prefix + '–°–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ', time, doc, context + ' NazwaSkrocona');
                    recm(prefix + '–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏', time, doc, context + ' DataRozpoczeciaDzialalnosci', 'Czas');
                    recm(prefix + '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ (–≤–∫–ª—é—á–∞—è –±–æ—Å—Å–∞)', time, doc, context + ' LiczbaPracujacych');
                    
                    context = 'WpisDoEwidencji EwidencjaGospodarcza RodzajeDzialalnosciGospodarczej';
                    prefix += '5.1. –í–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ - ';
                    var added = [];
                    var removed = [];
                    if (modified(doc, context)) {
                        recm(prefix + '–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏', time, doc, context + ' Przewazajacy');
                        var codes = doc.querySelectorAll(context + ' PKD2007');
                        for (var c = 0; c < codes.length; ++c) {
                            var code = codes[c];
                            if (code.attributes.wykreslenie.value == '0') {
                                added.push(code.innerHTML);
                            }
                            else {
                                removed.push(code.innerHTML);
                            }
                        }
                    }
                    rec(prefix + '–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–æ–ø. –∫–æ–¥—ã', time, added.join(', ') || '–Ω–µ—Ç', true, added.length == 0);
                    rec(prefix + '–£–¥–∞–ª–µ–Ω–Ω—ã–µ –¥–æ–ø. –∫–æ–¥—ã', time, removed.join(', ') || '–Ω–µ—Ç', true, removed.length == 0);
                    added.forEach(x => pkd[x] = 1);
                    removed.forEach(x => delete pkd[x]);
                    rec(prefix + '–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ–ø. –∫–æ–¥–æ–≤', time, Object.getOwnPropertyNames(pkd).sort().join(', ') || '–Ω–µ—Ç');
                    
                    context = 'WpisDoEwidencji EwidencjaGospodarcza AdresDoDoreczen';
                    if (modified(doc, context)) {
                        prefix = '6. –ê–¥—Ä–µ—Å –¥–ª—è –∫–æ—Ä—Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ü–∏–∏ - ';
                        rec(prefix + '–°—Ç—Ä–∞–Ω–∞', time, sel(doc, context + ' Kraj'));
                        rec(prefix + '–í–æ–µ–≤–æ–¥—Å—Ç–≤–æ', time, sel(doc, context + ' Wojewodztwo'));
                        rec(prefix + '–û–∫—Ä—É–≥', time, sel(doc, context + ' Powiat'));
                        rec(prefix + '–†–∞–π–æ–Ω', time, sel(doc, context + ' Gmina'));
                        rec(prefix + '–ü–æ—á—Ç–æ–≤—ã–π –∫–æ–¥', time, sel(doc, context + ' KodPocztowy'));
                        rec(prefix + '–ù–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç', time, sel(doc, context + ' Miejscowosc'));
                        rec(prefix + '–£–ª–∏—Ü–∞', time, sel(doc, context + ' Ulica'));
                        rec(prefix + '–ù–æ–º–µ—Ä –¥–æ–º–∞', time, sel(doc, context + ' Budynek'));
                        rec(prefix + '–ù–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã', time, sel(doc, context + ' Lokal'));
                        rec(prefix + '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è', time, sel(doc, context + ' Uwagi'));
                    }
                    
                    context = 'WpisDoEwidencji EwidencjaGospodarcza MiejscaWykonywaniaDzialalnosci GlowneMiejsceDzialalnosci';
                    if (modified(doc, context)) {
                        prefix = '7. –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∞–¥—Ä–µ—Å –≤–µ–¥–µ–Ω–∏—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ - ';
                        var brak = sel(doc, context, 'brak') == '1';
                        rec(prefix + '–ù–∞–ª–∏—á–∏–µ', time,  brak ? '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç' : '–ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç');
                        rec(prefix + '–°–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∞–¥—Ä–µ—Å–æ–º –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è', time,  sel(doc, context, 'jakZamieszkania') == '1' ? '–¥–∞' : '–Ω–µ—Ç');
                    }
                    
                    context = 'WpisDoEwidencji RejestrUbezpieczeniowy';
                    if (modified(doc, context)) {
                        prefix = '9. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ - ';
                        var kind = sel(doc, context, 'rodzaj');
                        rec(prefix + '–í–∏–¥ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è', time,  kind);
                        
                        var zusDocs = [];
                        var zusNode = doc.querySelector(context + ' WnioskiZus');
                        if (zusNode) {
                            if (zusNode.attributes.dolaczamZZA.value == '1') zusDocs.push('ZZA');
                            if (zusNode.attributes.dolaczamZUA.value == '1') zusDocs.push('ZUA');
                            if (zusNode.attributes.dolaczamZCNA.value == '1') zusDocs.push('ZCNA √ó ' + zusNode.attributes.iloscZCNA.value);
                            if (zusNode.attributes.dolaczamZWUA.value == '1') zusDocs.push('ZWUA');
                            if (zusNode.attributes.dolaczamZIUA.value == '1') zusDocs.push('ZIUA');
                            rec(prefix + 'ZUS - –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏', time, zusDocs.join(', ') || '–Ω–µ—Ç');
                        }
                        
                        rec(prefix + 'ZUS - –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –æ–ø–ª–∞—Ç—ã –≤–∑–Ω–æ—Å–æ–≤', time, sel(doc, context + ' ObowiazekSkladkowy Data Czas'));
                    }
                    
                    context = 'WpisDoEwidencji DokumentacjaRachunkowa NaczelnikUrzeduSkarbowego';
                    if (modified(doc, context)) {
                        rec('14. –ù–∞–ª–æ–≥–æ–≤–∞—è –∏–Ω—Å–ø–µ–∫—Ü–∏—è - –ù–∞—á–∞–ª—å–Ω–∏–∫', time, sel(doc, context + ' AktualnyDoSprawEwidencji'));
                    }
                    
                    context = 'WpisDoEwidencji DokumentacjaRachunkowa FormaOpodatkowania';
                    if (modified(doc, context)) {
                        rec('15. –í—ã–±–æ—Ä —Ñ–æ—Ä–º—ã –æ–ø–ª–∞—Ç—ã –ø–æ–¥–æ—Ö–æ–¥–Ω–æ–≥–æ –Ω–∞–ª–æ–≥–∞ - –§–æ—Ä–º–∞ –Ω–∞–ª–æ–≥–æ–æ–±–ª–æ–∂–µ–Ω–∏—è', time, sel(doc, context));
                    }
                    
                    context = 'WpisDoEwidencji DokumentacjaRachunkowa PodmiotProwadzacy';
                    if (modified(doc, context)) {
                        prefix = '17. –í–µ–¥–µ–Ω–∏–µ –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ - ';
                        rec(prefix + '–ö—Ç–æ –≤–µ–¥–µ—Ç', time, sel(doc, context + ' Firma') ? '–±—É—Ö–≥–∞–ª—Ç–µ—Ä' : '—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ');
                        rec(prefix + '–ë—É—Ö–≥–∞–ª—Ç–µ—Ä - NIP', time, sel(doc, context + ' NIP') || '–Ω–µ —É–∫–∞–∑–∞–Ω');
                        rec(prefix + '–ë—É—Ö–≥–∞–ª—Ç–µ—Ä - –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏—Ä–º—ã', time, sel(doc, context + ' Firma') || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ');
                    }
                    
                    context = 'WpisDoEwidencji DokumentacjaRachunkowa AdresPrzechowywania';
                    if (modified(doc, context)) {
                        prefix = '19. –ê–¥—Ä–µ—Å —Ö—Ä–∞–Ω–µ–Ω–∏—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ - ';
                        rec(prefix + '–°—Ç—Ä–∞–Ω–∞', time, sel(doc, context + ' Kraj'));
                        rec(prefix + '–í–æ–µ–≤–æ–¥—Å—Ç–≤–æ', time, sel(doc, context + ' Wojewodztwo'));
                        rec(prefix + '–û–∫—Ä—É–≥', time, sel(doc, context + ' Powiat'));
                        rec(prefix + '–†–∞–π–æ–Ω', time, sel(doc, context + ' Gmina'));
                        rec(prefix + '–ü–æ—á—Ç–æ–≤—ã–π –∫–æ–¥', time, sel(doc, context + ' KodPocztowy'));
                        rec(prefix + '–ù–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç', time, sel(doc, context + ' Miejscowosc'));
                        rec(prefix + '–£–ª–∏—Ü–∞', time, sel(doc, context + ' Ulica'));
                        rec(prefix + '–ù–æ–º–µ—Ä –¥–æ–º–∞', time, sel(doc, context + ' Budynek'));
                        rec(prefix + '–ù–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã', time, sel(doc, context + ' Lokal'));
                        rec(prefix + '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è', time, sel(doc, context + ' Uwagi'));
                    }
                    
                    context = 'WpisDoEwidencji DokumentacjaRachunkowa RachunkiBankowe RachunekBankowy';
                    prefix = '21. –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Å—á–µ—Ç–∞ - ';
                    var accounts = doc.querySelectorAll(context);
                    if (accounts.length > 0) {
                        for (var a = 0; a < accounts.length; ++a) {
                            var account = accounts[a];
                            var type = sel(account, 'CharakterRachunku');
                            var country = sel(account, 'Kraj');
                            var number = sel(account, 'NumerRachunku');
                            var removal = attr(account, 'likwidacja') == '1' || attr(account, 'rezygnacja') == '1';
                            var action = removal ? '—É–¥–∞–ª—ë–Ω ' : '–¥–æ–±–∞–≤–ª–µ–Ω ';
                            var typefix = prefix + (type == 'firmowy' ? '–ë–∏–∑–Ω–µ—Å-—Å—á—ë—Ç' : '–õ–∏—á–Ω—ã–π —Å—á—ë—Ç');
                            var forTaxReturn = attr(account, 'zwrotPodatku') == '1';
                            var taxReturnInfo = forTaxReturn ? ' - –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞–ª–æ–≥–æ–≤' : '';
                            var accountName = (country + number).replace(/(.{4})/g, '$1 ').trimEnd();
                            rec(typefix, time, action + accountName + taxReturnInfo);
                            var target = type == 'firmowy' ? businessBankAccounts : privateBankAccounts;
                            if (removal) {
                                delete target[accountName];
                            } else {
                                if (forTaxReturn) {
                                    var accs = Object.getOwnPropertyNames(target);
                                    for (var ba in accs) {
                                        target[accs[ba]] = false;
                                    }
                                }
                                target[accountName] = forTaxReturn;
                            }
                        }
                    }
                    if (!records.find(x => x.key == prefix + '–ë–∏–∑–Ω–µ—Å-—Å—á—ë—Ç')) {
                        rec(prefix + '–ë–∏–∑–Ω–µ—Å-—Å—á—ë—Ç', time, '–Ω–µ—Ç');
                    }
                    rec(prefix + '–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –±–∏–∑–Ω–µ—Å-—Å—á–µ—Ç–æ–≤', time, Object.getOwnPropertyNames(businessBankAccounts).sort().join(', ') || '–Ω–µ—Ç');
                    rec(prefix + '–°—á—ë—Ç –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞–ª–æ–≥–æ–≤', time, Object.keys(businessBankAccounts).find(key => businessBankAccounts[key]) || '–Ω–µ—Ç');
                    if (!records.find(x => x.key == prefix + '–õ–∏—á–Ω—ã–π —Å—á—ë—Ç')) {
                        rec(prefix + '–õ–∏—á–Ω—ã–π —Å—á—ë—Ç', time, '–Ω–µ—Ç');
                    }
                    rec(prefix + '–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ª–∏—á–Ω—ã—Ö —Å—á–µ—Ç–æ–≤', time, Object.getOwnPropertyNames(privateBankAccounts).sort().join(', ') || '–Ω–µ—Ç');

                    context = 'WpisDoEwidencji DokumentacjaRachunkowa MalzenskaWspolnoscMajatkowa';
                    if (modified(doc, context)) {
                        prefix = '23. –°–æ–≤–º–µ—Å—Ç–Ω–æ–µ –∏–º—É—â–µ—Å—Ç–≤–æ —Å —Å—É–ø—Ä—É–≥–æ–º - ';
                        rec(prefix + '–ù–∞–ª–∏—á–∏–µ', time, communityOfProperty(sel(doc, context + ' Stan')));
                    }
                    
                    var attachmentList = [];
                    var attachments = doc.querySelectorAll('Zalaczniki Zalacznik');
                    for (var f = 0; f < attachments.length; ++f) {
                        attachmentList.push(attachments[f].attributes.nazwaPliku.value);
                    }
                    rec('–í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã - –§–∞–π–ª—ã', time, attachmentList.join(', ') || '–Ω–µ—Ç', true, attachmentList.length == 0);
                }

                function ddl(values) {
                    var result = '<select class="versioned">';
                    for (var i = 0; i < values.length; ++i) {
                        var value = values[i];
                        result += '<option' + (i == values.length - 1 ? ' selected="selected"' : '') + (value.doNotHighlight ? ' class="doNotHighlight"' : '') + ' value="' + value.time + '">' + (value.doNotAddFrom ? '' : '–û—Ç ') + value.time + ': ' + value.value + '</option>';
                    }
                    result += '</select>';
                    return result;
                }

                var $output = $('#output');
                $output.empty();
                $output.append($('<table><tbody /></table>'));
                var $tbody = $output.find('table tbody');
                var prevHeaders = [];
                for (var r in records) {
                    var record = records[r];
                    
                    var recHeaders = record.key.split(' - ');
                    var key = recHeaders.pop();
                    
                    for (var h = 0; h < recHeaders.length; ++h) {
                        if (prevHeaders[h] == recHeaders[h]) continue;
                        var header = recHeaders[h];
                        var hn = 2 + h;
                        var cn = 10 + h * 2;
                        var color = cn.toString(16);
                        color = color + color + 'd';
                        $tbody.append($('<tr>' +
                            '<th colspan="2" style="background-color: #' + color + '"><h' + hn + ' style="margin: 0">' + header + '</h' + hn + '></th>' +
                        '</tr>'));
                    }
                    prevHeaders = recHeaders;
                    
                    $tbody.append($('<tr>' +
                        '<th>' + key + '</th>' +
                        '<td>' + ( record.values.length == 1 ? record.values[0].value : ddl(record.values) ) + '</td>' +
                    '</tr>'));
                }
                
                $('#version-container').show();
                $('#uploadFiles').hide();
                onVersionChanged();
            }
            
            function onVersionChanged() {
                var time = $('#version').val();
                $('select.versioned').each(function () {
                    $(this)
                        .val($(this).find('option').filter((idx, el) => $(el).attr('value') <= time).last().attr('value'))
                        .css('background-color', $(this).val() == time && !$(this).find('option[value=' + time + ']').hasClass('doNotHighlight') ? 'yellow' : 'white');
                });
            }
        </script>
    </head>
    <body style="margin: 0">
        <div id="version-container" style="display: none; position: sticky; top: 0px; font-weight: bold; font-size: 150%; padding: 5px; border-bottom: solid 1px #888; box-shadow: 0 0 15px; background-color: #ffe; text-align: center">
            <div id="reparse" style="float: right; cursor: pointer">üîÉ</div>
            –í–µ—Ä—Å–∏—è
            <select id="version" style="font-size: 20px">
            </select>
        </div>
        <div id="output" style="display: flex; flex-direction: column; align-items: center">
            <h2>–ü—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–ø–∏—Å–∏ –≤ CEIDG<sup>(beta)</sup></h2>
            <h3 style="margin-bottom: 0">–ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ, –∑–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ</h3>
            <p style="max-width: 1100px">–ß–∞—Å—Ç–æ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–∏ —Å—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è —Å –≤–æ–ø—Ä–æ—Å–æ–º, –∫–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ—é –∑–∞–ø–∏—Å—å –≤ CEIDG –≤ –µ—ë —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏, –≤–æ –≤—Å–µ–π –ø–æ–ª–Ω–æ—Ç–µ. –°–∞–π—Ç biznes.gov.pl, –∫ —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–∞–∫—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å, —Ç–∞ –≤—ã–ø–∏—Å–∫–∞, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–ª–µ–∫–æ –Ω–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ. –î–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é —Å–≤–æ–∏—Ö –∑–∞—è–≤–æ–∫ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–µ–∫—Ü–∏—è—Ö.</p>
            <h3 style="margin-bottom: 0">–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞</h3>
            <p style="max-width: 1100px">–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç –≤—Å–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–≤–æ–∏—Ö –∑–∞—è–≤–æ–∫ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ CEIDG –∏ –ø–æ–∫–∞–∂–µ—Ç –ø–æ–ª–Ω—É—é –∞–∫—Ç—É–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é –∑–∞–ø–∏—Å–∏, —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –º–µ–∂–¥—É –≤—Å–µ–º–∏ –µ—ë –≤–µ—Ä—Å–∏—è–º–∏. –î–ª—è —ç—Ç–æ–≥–æ —Ç–µ–±–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —Å–∫–∞—á–∞—Ç—å —Å–≤–æ–∏ –∑–∞—è–≤–∫–∏ —Å —Å–∞–π—Ç–∞ biznes.gov.pl –≤ —Ñ–æ—Ä–º–∞—Ç–µ XML, –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–æ –Ω–∏–∂–µ, –∏ –æ—Ç–∫—Ä—ã—Ç—å –∏—Ö –ø—Ä–∏ –ø–æ–º–æ—â–∏ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.</p>
            <p style="max-width: 1100px">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—á—Ç–∏, —á—Ç–æ —ç—Ç–æ beta-–≤–µ—Ä—Å–∏—è, –±—ã—Å—Ç—Ä–æ —Å–ª—è–ø–∞–Ω–Ω—ã–π –Ω–∞ –∫–æ–ª–µ–Ω–∫–µ proof of concept, –ø–æ—ç—Ç–æ–º—É –∫–æ–Ω–µ—á–Ω–æ –∂–µ —Ç—ã –º–æ–∂–µ—à—å –∑–∞–º–µ—Ç–∏—Ç—å –∫–∞–∫–∏–µ-–Ω–∏–±—É–¥—å –ª—è–ø—ã –∏ –Ω–µ–¥–æ—á—ë—Ç—ã. –î–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∏ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–π –º–Ω–µ –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–≤–æ–π –æ—Ç–∑—ã–≤, –∞ –¥–∞–∂–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã —Ç–≤–æ–∏—Ö —Ñ–∞–π–ª–æ–≤ —Å –ª–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç–µ XML —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Å–ª—É–∂–∏–ª–∏ –º–Ω–µ –ø—Ä–∏–º–µ—Ä–æ–º, –Ω–µ —Å–æ–¥–µ—Ä–∂–∞–ª–∏ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–∞–Ω–Ω—ã—Ö. –Ø –±—É–¥—É —Ä–∞–¥, –µ—Å–ª–∏ —Ç—ã –ø–æ—Å–æ–¥–µ–π—Å—Ç–≤—É–µ—à—å —É–ª—É—á—à–µ–Ω–∏—é –∫–æ–¥–∞.</p>
            <h3 style="margin-bottom: 0">–ß–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç —ç—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞</h3>
            <p style="max-width: 1100px">–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∞–º–∞ –ø–æ —Å–µ–±–µ –Ω–µ –ø–æ–¥–≤–µ—Ä–≥–∞–µ—Ç —Ç–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —Ç.–∫. –Ω–∏–∫—É–¥–∞ –Ω–µ –æ—Ç—Å—ã–ª–∞–µ—Ç –∏—Ö, –∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä—è–º–æ –≤ —Ç–≤–æ—ë–º –±—Ä–∞—É–∑–µ—Ä–µ, –Ω–∞ —Ç–≤–æ—ë–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ, —Å –ø–æ–º–æ—â—å—é —è–∑—ã–∫–∞ Javascript. –¢–∞–∫–∂–µ –æ–Ω–∞ –Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —Ç–≤–æ–∏ —Ñ–∞–π–ª—ã, –∞ –ª–∏—à—å —á–∏—Ç–∞–µ—Ç –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Ö. –ï—Å–ª–∏ —Ç—ã –¥–æ–≤–µ—Ä—è–µ—à—å —ç—Ç–æ–º—É –∫–æ–º–ø—å—é—Ç–µ—Ä—É –∏ —ç—Ç–æ–º—É –±—Ä–∞—É–∑–µ—Ä—É, —Ç–æ –Ω–µ—Ç –ø—Ä–∏—á–∏–Ω –±–µ—Å–ø–æ–∫–æ–∏—Ç—å—Å—è.</p>
            <h3 style="margin-bottom: 0">–ì–æ—Ç–æ–≤? –ü–æ–µ—Ö–∞–ª–∏!</h3>
            <ul>
                <li><a href="https://konto.biznes.gov.pl/pl/moje-konto" target="_blank">–ó–∞–π–¥–∏</a> –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—è –Ω–∞ —Å–∞–π—Ç–µ biznes.gov.pl.</li>
                <li>–ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –æ—Ç–∫—Ä–æ–π Moje sprawy - <a href="https://konto.biznes.gov.pl/pl/moje-konto/moje-sprawy/sprawy-zrealizowane" target="_blank">Sprawy zrealizowane</a>.</li>
                <li>–ü–æ –æ—á–µ—Ä–µ–¥–∏ –ø—Ä–æ–π–¥–∏—Å—å –ø–æ –≤—Å–µ–º –ø—É–Ω–∫—Ç–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è Zarejestruj dzia≈Çalno≈õƒá gospodarczƒÖ w CEIDG –∏–ª–∏ Zmie≈Ñ dane firmy w CEIDG.</li>
                <li>–í –∫–∞–∂–¥–æ–º –∏–∑ –Ω–∏—Ö –∫–ª–∏–∫–Ω–∏ –Ω–∞ —Ñ–∞–π–ª —Ç–∏–ø–∞ 20230101-1111-0737-wniosek.xml –∏ —Å–æ—Ö—Ä–∞–Ω–∏ –≤—Å–µ —Ç–∞–∫–∏–µ —Ñ–∞–π–ª—ã –≤ –æ–¥–Ω–æ–π –Ω–æ–≤–æ–π –ø–∞–ø–∫–µ –Ω–∞ —Å–≤–æ—ë–º –¥–∏—Å–∫–µ.</li>
                <li>–ü–æ–º–Ω–∏, —á—Ç–æ –≤–∞–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∂–¥—ã–π –∏–∑ —ç—Ç–∏—Ö —Ñ–∞–π–ª–æ–≤, –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –Ω–∏ –æ–¥–Ω–æ–≥–æ, —Ç.–∫. –∫–∞–∂–¥—ã–π —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ.</li>
                <li>–ö–æ–≥–¥–∞ —Å–∫–∞—á–∞–µ—à—å –≤—Å–µ —Ñ–∞–π–ª—ã, –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, –≤—ã–±–µ—Ä–∏ —Å—Ä–∞–∑—É –≤—Å–µ —Ñ–∞–π–ª—ã –∏ –æ–¥–Ω–∏–º –º–∞—Ö–æ–º –æ—Ç–∫—Ä–æ–π –∏—Ö.</li>
                <li>–ù–∞–∂–∏–º–∞—è –Ω–∞ –∫–Ω–æ–ø–∫—É –∏ –æ—Ç–∫—Ä—ã–≤–∞—è —Ñ–∞–π–ª—ã, —Ç—ã –≤—ã—Ä–∞–∂–∞–µ—à—å —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π, –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ, –Ω–∞ —ç—Ç–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ.</li>
            </ul>
            <input id="uploadFiles" type="file" accept="application/xml" multiple="multiple" style="margin-bottom: 30px" />
        </div>
    </body>
</html>